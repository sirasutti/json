<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>天気取得サンプル</title>
<style>
  body {
    font-family: sans-serif;
    margin: 20px;
  }
  select, button {
    margin-right: 10px;
  }
  table {
    border-collapse: collapse;
    margin-top: 20px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
  }
</style>
</head>
<body>
<h1>気象庁天気APIテスト（3日分）</h1>
<p>地域を選択して「取得」ボタンを押すと、3日分の天気を表示します。</p>
<select id="prefSelect">
  <option value="130000">東京</option>
  <option value="110000">埼玉</option>
</select>
<button id="fetchBtn">取得</button>

<div id="result"></div>

<script>
document.getElementById('fetchBtn').addEventListener('click', async () => {
  const areaCode = document.getElementById('prefSelect').value;
  const url = `https://www.jma.go.jp/bosai/forecast/data/forecast/${areaCode}.json`;
  
  try {
    const response = await fetch(url);
    if(!response.ok) {
      throw new Error('データ取得に失敗しました');
    }
    const data = await response.json();
    
    // dataは配列で戻る場合が多い（先頭要素を参照）
    const forecastData = data[0];

    // timeSeriesの中から日付、天気情報が格納された部分を取得
    // timeSeriesは複数あり、1つ目が天気コード、2つ目が降水確率、3つ目が気温など
    // 今回は簡易的に天気概況（weatherCodes）から天気を表示
    const times = forecastData.timeSeries[0].timeDefines;
    const weathers = forecastData.timeSeries[0].areas[0].weathers; // weather文言
    // 最初の3日分のみ使用（0,1,2）
    const targetCount = Math.min(3, times.length);

    // 結果表示用HTML構築
    let html = `<h2>${forecastData.publishingOffice}発表 (${forecastData.reportDatetime})</h2>`;
    html += '<table>';
    html += '<tr><th>日付</th><th>天気</th></tr>';
    for (let i = 0; i < targetCount; i++) {
      const dateStr = new Date(times[i]).toLocaleString('ja-JP', {
        year: 'numeric', month: 'numeric', day: 'numeric', weekday: 'short'
      });
      html += `<tr><td>${dateStr}</td><td>${weathers[i]}</td></tr>`;
    }
    html += '</table>';
    
    document.getElementById('result').innerHTML = html;
    
  } catch (error) {
    console.error(error);
    document.getElementById('result').textContent = '天気情報の取得に失敗しました。';
  }
});
</script>
</body>
</html>
